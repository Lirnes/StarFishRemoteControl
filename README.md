# Starfish Remote control

This repositories contains the source code to control remotely a SSS named Starfish 990. It comes with a Grafana interface to visualize the state of the sonar.


# Requirements

 - Windows environnement.
 - Grafana installed.
 - Grafana dashboard for the Starfish imported.
 - Grafana dependencies.
	 -   [Button Panel](https://github.com/cloudspout/cloudspout-button-panel) 
	 -   [Dynamic Image Panel](https://github.com/Dalvany/dalvany-image-panel)
	 - [SQLite](https://github.com/fr-ser/grafana-sqlite-datasource) 
 - Change Grafana variable "hostIP" in the Dashboard to the IP Adress of the machine that host the Grafana server.
 - Python's module from the requirement.txt.

## Usage

### General

To start the software, you need to launch with python StarFishScanner.py. 

    python ./StarFishScanner

Then, be hostIP the IP Adress of the host machine. You can :

 - Access the data server containing all the generated images by acceding http://hostIP:8000
 - Access the Grafana Dashboard by acceding http://hostIP:3000

Kill the program if you want to stop the servers.

### Grafana

From the Grafana interface, you can modify the StarFish parameters by clicking on a widget, and you can stop/start capture and visualisation by using the button.

### Saving

You can save the output folder on a USB device by pluggin in a USB key or other storage on the host computer. You will be notified when the saving is done on the Grafana interface.

### Configuration

You can configure the basic setup of the software by modifying the parameters.conf.

## CSV Format

SonarMode fetch data from the connected Starfish. It produces a CSV file every x second (precised in parameters.conf). This format is as follow :
-   P : Letter to design Port side
-   Contrast: Visualization value, contains the contrast value
-   Gain : Visualization value, contains the gain to apply to the whole image.
-   Range : The range parameters of the StarFish (Used to find seabed).
-   Samples : Number of samples on Port side
-   Data : The *samples* values of the Port side
<br>
-   S : Letter to design Starboard side
-   Contrast: Visualization value, contains the contrast value
-   Gain : Visualization value, contains the gain to apply to the whole image.
-   Range : The range parameters of the StarFish (Used to find seabed).
-   Samples : Number of samples on Starboard side
-   Data : The *samples* values of the Starboard side
 
 ## Known bug
- Contrast and gain work backwards, when we increment the gain or contrast, the image gets darker.
- When saving on USB drive, StarFishScanner shut down SonarMode and Visualize. If we are in the middle of building an image, then the process is stopped and the image need to be generated by hand.
